<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focal X - Node.js Bootcamp: Lecture 17 </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .footer {
            padding-top: 30px;
        }

        .footer a {
            color: black;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .coach {
            background-color: white;
            width: 80px;
            border-radius: 0 0 50% 0;
            color: black;
            padding: 10px;
            position: absolute;
            left: 0;
            top: 0;
        }
        
        header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
            height: 65vh;
        }
        
        .lecture-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }
        
        .interactive-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }
        
        h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
            font-size: 1.5rem;
        }
        
        h3 {
            color: #2980b9;
            margin: 20px 0 12px;
            font-size: 1.2rem;
        }
        
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 12px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 12px 0;
            font-size: 0.9rem;
        }
        
        code {
            font-family: 'Fira Code', monospace;
        }
        
        .question {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            margin: 12px 0;
        }
        
        .option {
            padding: 10px;
            background: #e8f4fc;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 0.9rem;
        }
        
        .option:hover {
            background: #d1e9fa;
        }
        
        .correct {
            background: #d4edda;
            border: 1px solid #c3e6cb;
        }
        
        .incorrect {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
        }
        
        .task {
            background: #fff3cd;
            padding: 12px;
            border-left: 5px solid #ffc107;
            margin: 15px 0;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s;
            margin-top: 8px;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .result {
            margin-top: 12px;
            padding: 12px;
            border-radius: 5px;
            display: none;
            font-size: 0.9rem;
        }
        
        .search-task {
            background: #e7f5e9;
            padding: 12px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 5px solid #28a745;
            font-size: 0.9rem;
        }
        
        .tabs {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 8px 15px;
            cursor: pointer;
            background: #f1f1f1;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .tab.active {
            background: #6f42c1;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            font-size: 0.9rem;
        }
        
        .comparison-table th, .comparison-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        
        .comparison-table th {
            background-color: #3498db;
            color: white;
        }
        
        .comparison-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        @media (max-width: 900px) {
            .content {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .lecture-content, .interactive-section {
                height: 50vh;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <p class="coach">Moones Mezher</p>
        <header>
            <h1 id="lecture-title">Focal X - Node.js Bootcamp</h1>
            <p class="subtitle" id="lecture-subtitle">Node</p>
        </header>
        
        <div class="content">
            <div class="lecture-content">
                <h2>Lecture Content</h2>
                <div id="tabs-container"></div>
                <div id="tab-content-container"></div>
            </div>
            
            <div class="interactive-section">
                <h2>Interactive Questions & Tasks</h2>
                <div id="questions-container"></div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>&copy; 2025 <a rel="noopener" href="https://focal-x.com/" target="_blank">Focal X</a> All Right Reserved</p>
    </footer>

    <script>
        // ==================== CONFIGURATION ====================
        // Update these arrays to change the content of your lecture
        
        // Lecture metadata
        const lectureConfig = {
            title: "Focal X - Node.js Bootcamp",
            subtitle: "ExpressJS (Advanced)"
        };
        
       // Lecture content organized by tabs
const lectureContent = [
    {
        tabTitle: "Last Lesson",
        title: "Last Lesson Recap",
        content: `/*
1- Solve Task 5
*/`
    },
    {
        tabTitle: "Project Structure & Organization",
        title: "Scalable Express Application Architecture",
        content: `/*
Recommended Project Structure:
src/
  ├── controllers/     # Route handlers (OOP style)
  ├── routes/         # Route definitions
  ├── middlewares/    # Custom middleware functions
  ├── models/         # Data models and schemas
  ├── config/         # Configuration files
  ├── utils/          # Utility functions
  └── app.js          # Express app setup

Benefits:
• Better code organization
• Easier maintenance
• Separation of concerns
• Team collaboration
• Testing simplicity
*/

// Example of OOP Controller with try-catch
class UserController {
    async getAllUsers(req, res) {
        try {
            // Business logic here
            const users = await UserModel.findAll();
            res.json({
                success: true,
                count: users.length,
                data: users
            });
        } catch (error) {
            console.error('Get users error:', error);
            res.status(500).json({
                success: false,
                error: 'Failed to fetch users'
            });
        }
    }

    async createUser(req, res) {
        try {
            const { name, email, age } = req.body;
            
            // Validation
            if (!name || !email) {
                return res.status(400).json({
                    success: false,
                    error: 'Name and email are required'
                });
            }

            const newUser = await UserModel.create({ name, email, age });
            
            res.status(201).json({
                success: true,
                message: 'User created successfully',
                data: newUser
            });
        } catch (error) {
            console.error('Create user error:', error);
            res.status(500).json({
                success: false,
                error: 'Failed to create user'
            });
        }
    }
}

// Route definition example (routes/users.js)
const express = require('express');
const router = express.Router();
const userController = new UserController();

router.get('/', userController.getAllUsers.bind(userController));
router.post('/', userController.createUser.bind(userController));

module.exports = router;

// Main app.js structure
const express = require('express');
const app = express();

// Middleware
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Routes
app.use('/api/users', require('./src/routes/users'));
app.use('/api/products', require('./src/routes/products'));

// Error handling middleware
app.use(require('./src/middlewares/errorHandler'));

module.exports = app;

// Using plop.js for code generation (devDependencies)
// Why in devDependencies? Only used during development, not in production`
    },
    {
        tabTitle: "CRUD Operations & Validation",
        title: "Building Robust CRUD APIs",
        content: `/*
Complete CRUD Implementation with:
• Input validation
• Error handling with try-catch
• Proper status codes
• Data sanitization
*/

let users = [
    { id: 1, name: "moones", age: 21, email: "moones@example.com" },
    { id: 2, name: "rami", age: 31, email: "rami@example.com" },
    { id: 3, name: "dana", age: 41, email: "dana@example.com" }
];

// Input validation middleware
const validateUser = (req, res, next) => {
    try {
        const { name, age, email } = req.body;
        const errors = [];

        if (!name || typeof name !== 'string' || name.length < 2) {
            errors.push('Name must be a string with at least 2 characters');
        }

        if (!age || typeof age !== 'number' || age < 18 || age > 120) {
            errors.push('Age must be a number between 18 and 120');
        }

        if (!email || !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email)) {
            errors.push('Valid email is required');
        }

        if (errors.length > 0) {
            return res.status(400).json({ 
                success: false,
                error: 'Validation failed', 
                details: errors 
            });
        }

        next();
    } catch (error) {
        res.status(500).json({
            success: false,
            error: 'Validation error'
        });
    }
};

// GET all users with filtering and error handling
app.get('/api/users', async (req, res) => {
    try {
        const { minAge, maxAge, search } = req.query;
        let filteredUsers = [...users];

        if (minAge) {
            filteredUsers = filteredUsers.filter(user => user.age >= parseInt(minAge));
        }

        if (maxAge) {
            filteredUsers = filteredUsers.filter(user => user.age <= parseInt(maxAge));
        }

        if (search) {
            filteredUsers = filteredUsers.filter(user => 
                user.name.toLowerCase().includes(search.toLowerCase())
            );
        }

        res.json({
            success: true,
            count: filteredUsers.length,
            data: filteredUsers
        });
    } catch (error) {
        console.error('Get users error:', error);
        res.status(500).json({
            success: false,
            error: 'Failed to fetch users'
        });
    }
});

// POST create user with validation
app.post('/api/users', validateUser, async (req, res) => {
    try {
        const { name, age, email } = req.body;
        
        // Check for duplicate email
        const existingUser = users.find(u => u.email === email);
        if (existingUser) {
            return res.status(409).json({
                success: false,
                error: 'User with this email already exists'
            });
        }

        const newId = Math.max(...users.map(u => u.id)) + 1;
        const newUser = { id: newId, name, age, email };
        
        users.push(newUser);
        
        res.status(201).json({
            success: true,
            message: 'User created successfully',
            data: newUser
        });
    } catch (error) {
        console.error('Create user error:', error);
        res.status(500).json({
            success: false,
            error: 'Failed to create user'
        });
    }
});

// PUT update user
app.put('/api/users/:id', validateUser, async (req, res) => {
    try {
        const id = parseInt(req.params.id);
        const userIndex = users.findIndex(u => u.id === id);

        if (userIndex === -1) {
            return res.status(404).json({
                success: false,
                error: 'User not found'
            });
        }

        const { name, age, email } = req.body;
        
        // Check email uniqueness (excluding current user)
        const emailExists = users.some(u => u.email === email && u.id !== id);
        if (emailExists) {
            return res.status(409).json({
                success: false,
                error: 'Email already in use by another user'
            });
        }

        users[userIndex] = { ...users[userIndex], name, age, email };

        res.json({
            success: true,
            message: 'User updated successfully',
            data: users[userIndex]
        });
    } catch (error) {
        console.error('Update user error:', error);
        res.status(500).json({
            success: false,
            error: 'Failed to update user'
        });
    }
});`
    },
    {
        tabTitle: "Advanced Express Features",
        title: "Production-Ready Express Applications",
        content: `/*
Production Best Practices:
• Environment configuration
• Security headers
• Rate limiting
• Request sanitization
• Proper error handling
• Logging
• Performance optimization
*/

const cors = require('cors');
const helmet = require('helmet');
const rateLimit = require('express-rate-limit');
const compression = require('compression');

// Security middleware
app.use(helmet({
    contentSecurityPolicy: {
        directives: {
            defaultSrc: ["'self'"],
            styleSrc: ["'self'", "'unsafe-inline'"],
            scriptSrc: ["'self'"],
            imgSrc: ["'self'", "data:", "https:"],
        },
    },
    crossOriginEmbedderPolicy: false
}));

// CORS configuration
app.use(cors({
    origin: process.env.ALLOWED_ORIGINS?.split(',') || ['http://localhost:3000'],
    credentials: true
}));

// Rate limiting
const limiter = rateLimit({
    windowMs: 15 * 60 * 1000, // 15 minutes
    max: 100, // limit each IP to 100 requests per windowMs
    message: {
        error: 'Too many requests from this IP, please try again later.'
    }
});
app.use('/api/', limiter);

// Compression
app.use(compression());

// Environment-based configuration
const config = {
    development: {
        port: 4000,
        host: 'localhost',
        logLevel: 'debug'
    },
    production: {
        port: process.env.PORT || 80,
        host: '0.0.0.0',
        logLevel: 'warn'
    }
};

const environment = process.env.NODE_ENV || 'development';
const currentConfig = config[environment];

// Advanced error handling
class AppError extends Error {
    constructor(message, statusCode) {
        super(message);
        this.statusCode = statusCode;
        this.isOperational = true;
        Error.captureStackTrace(this, this.constructor);
    }
}

// Async error wrapper (avoid try-catch in every route)
const asyncHandler = (fn) => (req, res, next) => {
    Promise.resolve(fn(req, res, next)).catch(next);
};

// Example with async handler
app.get('/api/async-users', asyncHandler(async (req, res) => {
    // Simulate async operation
    const users = await Promise.resolve([...users]);
    res.json({ success: true, data: users });
}));

// Global error handler
app.use((err, req, res, next) => {
    err.statusCode = err.statusCode || 500;
    err.status = err.status || 'error';

    if (process.env.NODE_ENV === 'development') {
        res.status(err.statusCode).json({
            status: err.status,
            error: err,
            message: err.message,
            stack: err.stack
        });
    } else {
        // Production: don't leak error details
        if (err.isOperational) {
            res.status(err.statusCode).json({
                status: err.status,
                message: err.message
            });
        } else {
            console.error('ERROR 💥', err);
            res.status(500).json({
                status: 'error',
                message: 'Something went wrong!'
            });
        }
    }
});

// Graceful shutdown
process.on('SIGTERM', () => {
    console.log('SIGTERM received. Shutting down gracefully...');
    server.close(() => {
        console.log('Process terminated');
    });
});`
    }
];

// Enhanced Questions and Tasks with new content
const questions = [
    // Project Structure & Organization
    {
        type: "question",
        question: "What is the main benefit of organizing code into controllers, routes, and models?",
        options: [
            "It makes the code run faster",
            "It improves code organization and separation of concerns",
            "It reduces the number of files",
            "It eliminates the need for documentation"
        ],
        correctIndex: 1
    },
    {
        type: "question",
        question: "Why should plop.js be installed as a devDependency?",
        options: [
            "Because it's only used during development for code generation",
            "Because it's too large for production",
            "Because it conflicts with other dependencies",
            "Because it's not compatible with production environments"
        ],
        correctIndex: 0
    },

    // Middleware & Error Handling
    {
        type: "question",
        question: "What is the purpose of using try-catch blocks in controller methods?",
        options: [
            "To make code run faster",
            "To handle synchronous and asynchronous errors gracefully",
            "To reduce code length",
            "To automatically log all requests"
        ],
        correctIndex: 1
    },

    // Practical Tasks - Development Tools
    {
        type: "task",
        title: "Environment Setup & API Testing",
        content: "Set up a new Express project with proper environment configuration. Create a .env file with PORT, DATABASE_URL, and JWT_SECRET variables. Install and configure dotenv. Test your API endpoints using both Postman and Thunder Client, creating a collection of test cases."
    },

    // Practical Tasks - Express.js
    {
        type: "task",
        title: "Complete REST API Implementation",
        content: "Build a complete REST API for a 'products' resource with full CRUD operations. Include input validation, proper HTTP status codes, error handling with try-catch, and implement filtering, sorting, and pagination for the GET endpoints."
    },
    {
        type: "task", 
        title: "API Security Implementation",
        content: "Secure your Express application by implementing CORS, Helmet for security headers, input sanitization, and parameter validation. Add rate limiting and implement proper authentication using JWT tokens with environment variables for secrets."
    },

    // Search & Research Tasks
    {
        type: "search-task",
        title: "Research: Express.js Best Practices",
        content: "Research and document Express.js best practices for production applications. Include topics like project structure, environment configuration, performance optimization, security practices, and deployment strategies. Create a checklist for production-ready Express applications."
    },
    {
        type: "search-task",
        title: "Advanced: API Testing Strategies",
        content: "Research different API testing approaches and tools. Compare Postman, Thunder Client, Jest for API testing, and automated testing strategies. Create a comprehensive testing suite for an Express API including unit tests, integration tests, and end-to-end tests."
    },

    // Debugging & Problem Solving
    {
        type: "task",
        title: "Debugging Challenge",
        content: "Given a buggy Express application with multiple issues (CORS errors, environment variable problems, middleware order issues, route conflicts), identify and fix all the issues. Document each problem and your solution approach, focusing on proper error handling and project structure."
    },
    {
        type: "task",
        title: "Performance Optimization",
        content: "Analyze an existing Express application for performance bottlenecks. Implement compression, caching strategies, database optimization, and proper error handling. Use tools to monitor and improve application performance."
    }
];// Functions to render the content - you don't need to modify these
        
        // Set lecture title and subtitle
        document.getElementById('lecture-title').textContent = lectureConfig.title;
        document.getElementById('lecture-subtitle').textContent = lectureConfig.subtitle;
        
        // Render tabs and content
        function renderTabsAndContent() {
            const tabsContainer = document.getElementById('tabs-container');
            const contentContainer = document.getElementById('tab-content-container');
            
            // Create tabs
            const tabs = document.createElement('div');
            tabs.className = 'tabs';
            
            // Create tab content areas
            lectureContent.forEach((content, index) => {
                // Create tab
                const tab = document.createElement('div');
                tab.className = 'tab' + (index === 0 ? ' active' : '');
                tab.textContent = content.tabTitle;
                tab.onclick = () => switchTab(index);
                tabs.appendChild(tab);
                
                // Create content
                const tabContent = document.createElement('div');
                tabContent.className = 'tab-content' + (index === 0 ? ' active' : '');
                tabContent.id = 'tab-' + index;
                
                // Add title
                const title = document.createElement('h3');
                title.textContent = content.title;
                tabContent.appendChild(title);
                
                // Add code content
                const pre = document.createElement('pre');
                const code = document.createElement('code');
                code.textContent = content.content;
                pre.appendChild(code);
                tabContent.appendChild(pre);

                // Add table if exists
                if (content.table) {
                    const table = document.createElement('table');
                    table.className = 'comparison-table';
                    
                    // Create header
                    const thead = document.createElement('thead');
                    const headerRow = document.createElement('tr');
                    content.table.headers.forEach(headerText => {
                        const th = document.createElement('th');
                        th.textContent = headerText;
                        headerRow.appendChild(th);
                    });
                    thead.appendChild(headerRow);
                    table.appendChild(thead);
                    
                    // Create body
                    const tbody = document.createElement('tbody');
                    content.table.rows.forEach(rowData => {
                        const row = document.createElement('tr');
                        rowData.forEach(cellData => {
                            const td = document.createElement('td');
                            td.textContent = cellData;
                            row.appendChild(td);
                        });
                        tbody.appendChild(row);
                    });
                    table.appendChild(tbody);
                    
                    tabContent.appendChild(table);
                }
                
                
                contentContainer.appendChild(tabContent);
            });
            
            tabsContainer.appendChild(tabs);
        }
        
        // Switch tabs function
        function switchTab(index) {
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Add active class to clicked tab
            tabs[index].classList.add('active');
            
            // Hide all tab content
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById('tab-' + index).classList.add('active');
        }
        
        // Render questions and tasks
        function renderQuestions() {
            const container = document.getElementById('questions-container');
            
            questions.forEach((q, index) => {
                if (q.type === 'question') {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question';
                    
                    const questionTitle = document.createElement('h3');
                    questionTitle.textContent = `Question ${index + 1}: ${q.question}`;
                    questionDiv.appendChild(questionTitle);
                    
                    if (q.code) {
                        const pre = document.createElement('pre');
                        const code = document.createElement('code');
                        code.textContent = q.code;
                        pre.appendChild(code);
                        questionDiv.appendChild(pre);
                    }
                    
                    const optionsDiv = document.createElement('div');
                    optionsDiv.className = 'options';
                    
                    q.options.forEach((option, optIndex) => {
                        const optionDiv = document.createElement('div');
                        optionDiv.className = 'option';
                        optionDiv.textContent = option;
                        optionDiv.onclick = function() {
                            checkAnswer(this, optIndex === q.correctIndex ? 'correct' : 'incorrect');
                        };
                        optionsDiv.appendChild(optionDiv);
                    });
                    
                    questionDiv.appendChild(optionsDiv);
                    
                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'result';
                    resultDiv.id = 'result-' + index;
                    questionDiv.appendChild(resultDiv);
                    
                    container.appendChild(questionDiv);
                } else if (q.type === 'task') {
                    const taskDiv = document.createElement('div');
                    taskDiv.className = 'task';
                    
                    const taskTitle = document.createElement('h3');
                    taskTitle.textContent = q.title;
                    taskDiv.appendChild(taskTitle);
                    
                    const taskContent = document.createElement('p');
                    taskContent.textContent = q.content;
                    taskDiv.appendChild(taskContent);
                    
                    container.appendChild(taskDiv);
                } else if (q.type === 'search-task') {
                    const searchTaskDiv = document.createElement('div');
                    searchTaskDiv.className = 'search-task';
                    
                    const taskTitle = document.createElement('h3');
                    taskTitle.textContent = q.title;
                    searchTaskDiv.appendChild(taskTitle);
                    
                    const taskContent = document.createElement('p');
                    taskContent.textContent = q.content;
                    searchTaskDiv.appendChild(taskContent);
                    
                    container.appendChild(searchTaskDiv);
                }
            });
        }
        
        // Check answer function
        function checkAnswer(element, type) {
            const options = element.parentElement.querySelectorAll('.option');
            options.forEach(opt => {
                opt.classList.remove('correct', 'incorrect');
                opt.onclick = null;
            });
            
            element.classList.add(type);
            
            const resultId = element.closest('.question').querySelector('.result').id;
            const resultDiv = document.getElementById(resultId);
            resultDiv.style.display = 'block';
            
            if (type === 'correct') {
                resultDiv.innerHTML = '<p style="color: #155724">✅ Correct! Good job.</p>';
                resultDiv.style.backgroundColor = '#d4edda';
            } else {
                resultDiv.innerHTML = '<p style="color: #721c24">❌ Incorrect. Try to understand why.</p>';
                resultDiv.style.backgroundColor = '#f8d7da';
            }
        }
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            renderTabsAndContent();
            renderQuestions();
        });
    </script>
</body>
</html>